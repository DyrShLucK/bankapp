apiVersion: v1
kind: ConfigMap
resources:
  requests:
    cpu: "100m"
    memory: "512Mi"
  limits:
    cpu: "1000m"
    memory: "2Gi"
elasticsearch:
  hosts: "http://elasticsearch.logging.svc.cluster.local:9200"
volumeClaimTemplate:
  accessModes: ["ReadWriteOnce"]
  resources:
    requests:
      storage: 512Mi
logstashConfig:
  logstash.yml: |
    http.host: 0.0.0.0
    xpack.monitoring.enabled: false
metadata:
  name: logstash-pipeline
  namespace: log
logstashPipeline:
  logstash.conf: |
    
    input {
      kafka {
        bootstrap_servers => "kafka.kafka-dev.svc.cluster.local:9092" # Адрес Kafka-сервера в кластере
        topics => ["bank-app-logs"] # Название топика
        group_id => "logstash-consumer-group" # Consumer Group ID
        codec => json # Предполагается, что логи в JSON
        auto_offset_reset => "latest" # Начинать с последнего сообщения
      }
    }

    filter {
      if [message] =~ /^{.*}$/ {
        json {
          source => "message"
          target => "parsed_json"
        }
      }
    }

    output {
      elasticsearch {
        hosts => ["http://elasticsearch-master.log.svc.cluster.local:9200"] 
        index => "bank-logs-%{+YYYY.MM.dd}" 
        manage_template => false 
      }
    }